# 拓展插件配置开发文档 (适用FP框架版本1.0.0)

## 1. 引言

### 1.1 文档目的
本文档详细描述拓展插件配置文件的结构、字段含义及使用方法，帮助开发者快速理解并创建符合规范的插件配置，实现自定义功能扩展。

### 1.2 插件概述
拓展插件是基于JSON配置文件的轻量级功能模块，通过定义按键操作逻辑和状态提示，实现对主程序的功能增强。支持两种核心插件类型：开关型插件（持续运行）和按钮型插件（单次触发），可灵活组合形成插件包。

### 1.3 适用场景
- 自动化操作：如定时执行特定按键组合
- 快捷操作：将复杂操作简化为一键触发
- 状态提示：在关键操作节点提供可视化反馈

## 2. 配置文件基础规范

### 2.1 文件格式与命名
- 格式：采用UTF-8编码的JSON文件
- 命名规则：建议使用`[插件包名称].plugin.json`格式，如`drop-actions.plugin.json`
- 文件结构：严格遵循JSON语法规范，不支持注释（生产环境）

### 2.2 核心设计理念
- 声明式配置：通过描述"做什么"而非"怎么做"实现功能
- 模块化组合：单个插件包可包含多个功能插件
- 低耦合设计：插件与主程序通过标准接口交互，不依赖内部实现

## 3. 根节点配置详解

根节点包含插件包的元数据和插件集合，结构如下：
```json
{
  "_title": "拓展插件",
  "_type": "_PLUGIN_PACK_",
  "_version": "1.0.0",
  "_description": "包含自动丢弃和手动丢弃功能的插件包",
  "_author": "插件开发团队",
  "_plugin": [
    // 插件定义数组
  ]
}
```
### 3.1 根节点字段说明

| 字段名         | 类型   | 必选 | 说明                                                                 | 约束与规范                                                                 |
|----------------|--------|------|----------------------------------------------------------------------|----------------------------------------------------------------------------|
| `_title`       | string | 是   | 插件包的显示名称，用于在插件管理界面展示                             | 长度不超过64字符，支持中英文，建议简洁明了                                   |
| `_type`        | string | 是   | 插件包类型标识，用于主程序识别配置文件类型                           | 固定值为`_PLUGIN_PACK_`，区分于单个插件配置                                 |
| `_version`     | string | 否   | 插件包版本号，遵循语义化版本规范（主版本.次版本.修订号）             | 格式为`x.y.z`，如`1.2.3`，主版本号变更表示不兼容更新                       |
| `_description` | string | 否   | 插件包的功能描述，说明包含的插件及整体用途                           | 长度不超过512字符，建议说明核心功能和适用场景                               |
| `_author`      | string | 否   | 插件包开发者信息，用于问题反馈和技术支持                             | 建议格式：`名称/组织 <联系方式>`，如`"开发团队 <plugin@example.com>"`      |
| `_plugin`      | array  | 是   | 插件定义数组，包含一个或多个具体插件的配置                           | 数组元素必须是符合插件格式规范的JSON对象，至少包含一个插件                   |

## 4. 插件通用配置

`_plugin`数组中的每个元素为一个独立插件，所有插件共享以下基础结构：
```json
{
  "name": "插件名称",
  "id": "unique-plugin-id",
  "version": "1.0.0",
  "description": "插件功能描述",
  "model": "_Style.SWITCH_",
  "program": {
    // 插件行为逻辑
  }
}
```
### 4.1 通用字段说明

| 字段名        | 类型   | 必选 | 说明                                                                 | 约束与规范                                                                 |
|---------------|--------|------|----------------------------------------------------------------------|----------------------------------------------------------------------------|
| `name`        | string | 是   | 插件的显示名称，用于在插件列表和操作界面展示                         | 长度不超过32字符，建议使用中文名称，直观反映功能                             |
| `id`          | string | 否   | 插件的唯一标识符，用于程序内部识别和版本管理                         | 建议使用反向域名格式，如`com.example.plugins.autodrop`，确保全局唯一         |
| `version`     | string | 否   | 单个插件的版本号，独立于插件包版本                                   | 格式为`x.y.z`，用于插件单独更新和兼容性判断                                 |
| `description` | string | 否   | 插件的详细功能说明，解释插件的具体作用和使用方法                     | 长度不超过256字符，建议说明触发条件和预期效果                               |
| `model`       | string | 是   | 插件的交互模式，决定功能快捷键的触发方式和状态管理                           | 仅支持两个值：`_Style.SWITCH_`（开关型）和`_Style.Button_`（按钮型）        |

## 5. 插件类型详解

### 5.1 开关型插件（`_Style.SWITCH_`）

#### 5.1.1 功能特点
- 具有"开启"和"关闭"两种互斥状态
- 状态切换时可执行不同操作逻辑
- 开启状态可维持持续运行的功能（如定时操作）
- 支持状态记忆（重启后可恢复上次状态）

#### 5.1.2 `program`字段说明

| 字段名      | 类型   | 必选 | 说明                                                                 | 典型用途                                                                   |
|-------------|--------|------|----------------------------------------------------------------------|----------------------------------------------------------------------------|
| `other.On`  | array  | 是   | 开关被外部触发开启时执行的操作序列（如通过快捷键或API）               | 启动持续任务（如循环按键）、初始化资源                                       |
| `other.Off` | array  | 是   | 开关被外部触发关闭时执行的操作序列                                   | 停止持续任务、释放资源、恢复初始状态                                         |
| `on.On`     | array  | 否   | 开关状态切换为开启后执行的操作序列（通常用于用户反馈）               | 显示开启提示、记录日志                                                       |
| `on.Off`    | array  | 否   | 开关状态切换为关闭后执行的操作序列（通常用于用户反馈）               | 显示关闭提示、记录状态变更                                                   |

#### 5.1.3 工作流程
1. 用户通过快捷键或界面操作触发开关开启
2. 用户开启功能 显示功能快捷键 执行`on.On`中的操作（如显示"自动丢弃已激活"提示）
3. 快捷键被激活 执行`other.On`中的操作（如开始每秒按下Q键）
4. 开关保持开启状态，持续执行`other.On`中定义的循环操作
5. 用户触发开关关闭
6. 快捷键状态被关闭 执行`other.Off`中的操作（如停止按键循环）
7. 功能被关闭 关闭功能快捷键 执行`on.Off`中的操作（如显示"自动丢弃已关闭"提示）

### 5.2 按钮型插件（`_Style.Button_`）

#### 5.2.1 功能特点
- 无持续状态，仅在被激活时执行一次操作
- 每次激活都从头执行完整操作序列
- 支持防抖配置（防止误触多次触发）
- 适合单次性操作（如执行一次按键组合）

#### 5.2.2 `program`字段说明

| 字段名          | 类型   | 必选 | 说明                                                                 | 典型用途                                                                   |
|-----------------|--------|------|----------------------------------------------------------------------|----------------------------------------------------------------------------|
| `on.On`         | array  | 否   | 按钮处于可用状态时的操作（通常为空）                                 | 初始化按钮样式、更新状态提示                                                 |
| `on.Off`        | array  | 否   | 按钮处于禁用状态时的操作（通常为空）                                 | 更改按钮样式、提示禁用原因                                                   |
| `on.Activate`   | array  | 是   | 按钮被点击或通过快捷键激活时执行的操作序列                           | 执行单次按键操作、触发一次性任务                                             |

#### 5.2.3 工作流程
1. 按钮处于可用状态（`on.On`操作可用于初始化显示）
2. 用户点击按钮或按下快捷键
3. 执行`on.Activate`中的操作序列（如执行一次Q+Z键操作）
4. 操作完成后按钮回到初始状态，等待下次激活

## 6. 操作类型详解

插件的具体功能通过`program`字段中的操作数组实现，目前支持两种核心操作类型。

### 6.1 按键输入工具（`IKeyIuputTool`）

用于模拟键盘输入操作，支持单个按键、组合键和持续输入，结构如下：
```json
{
  "class": "IKeyIuputTool",
  "Input": {
    "rate": 100,
    "key": "_Q_",
    "onKey": "_Z_",
    "fnKey":[],
    "delay": 500,
    "repeat": 3
  }
}
```
#### 字段说明

| 字段名      | 类型   | 必选 | 说明                                                                 | 取值范围与示例                                                             |
|-------------|--------|------|----------------------------------------------------------------------|----------------------------------------------------------------------------|
| `class`     | string | 是   | 操作类型标识，固定为`IKeyIuputTool`                                  | 固定值：`"IKeyIuputTool"`                                                  |
| `Input`     | object | 是   | 按键输入配置参数集合                                                 | 包含以下子字段                                                             |
| `rate`      | number | 是   | 输入速率控制：<br>- 正数：以1秒为基准，连续输入的次数（次）<br>- -1：单次输入（按下即释放） | 如`100`（每1s输入100次）、`-1`（仅输入一次）                              |
| `key`       | string | 是   | 主按键标识，指定要输入的按键                                         | 按键名称需用下划线包裹，如`_Q_`、`_ENTER_`、`_SPACE_`                       |
| `onKey`     | string | 否   | 主按键标识，指定要输入的按键，但是用于非全键盘玩法                                | 格式同`key`，如`_CTRL_`、`_SHIFT_`，空字符串表示无辅助按键                  |
| `fnKey`     | array | 否   | 辅助按键（组合键），与主按键同时按下                                 | 格式同`key`，如`_CTRL_`、`_SHIFT_`，空数组表示无辅助按键                  |
| `delay`     | number | 否   | 延迟执行时间（毫秒），表示操作开始前的等待时间                         | 非负整数，如`500`（延迟500ms执行），默认值为0                              |
| `repeat`    | number | 否   | 重复执行次数，仅对`rate`为正数时有效                                 | 正整数，如`3`（执行3次后停止），默认值为-1（无限重复，直到被终止）          |

### 6.2 提示消息工具（`Toast`）

用于在操作过程中向用户显示轻量级提示消息，结构如下：
```json
{
  "class": "Toast",
  "message": "自动丢弃已激活",
  "duration": 3000,
  "position": "bottom",
  "type": "info"
}
```
#### 字段说明

| 字段名      | 类型   | 必选 | 说明                                                                 | 取值范围与示例                                                             |
|-------------|--------|------|----------------------------------------------------------------------|----------------------------------------------------------------------------|
| `class`     | string | 是   | 操作类型标识，固定为`Toast`                                          | 固定值：`"Toast"`                                                          |
| `message`   | string | 是   | 提示消息的文本内容                                                   | 长度建议不超过128字符，支持中英文混合                                       |
| `duration`  | number | 否   | 消息显示时长（毫秒）                                                 | 正整数，如`3000`（显示3秒），默认值为2000                                  |
| `position`  | string | 否   | 消息显示位置                                                         | 可选值：`"top"`（顶部）、`"bottom"`（底部）、`"left"`（左侧）、`"right"`（右侧），默认`"bottom"` |
| `type`      | string | 否   | 消息类型，决定显示样式（颜色、图标）                                 | 可选值：`"info"`（信息）、`"success"`（成功）、`"warning"`（警告）、`"error"`（错误），默认`"info"` |

## 7. 完整配置示例
```json
{
  "_title": "拓展插件",
  "_type": "_PLUGIN_PACK_",
  "_version": "1.0.0",
  "_description": "包含自动丢弃和手动丢弃功能，通过Q键组合实现快速操作",
  "_author": "开发团队 <plugin-support@example.com>",
  "_plugin": [
    {
      "name": "自动丢弃",
      "id": "com.example.plugins.autodrop",
      "version": "1.0.0",
      "description": "开启后每100毫秒自动执行一次Q键组合，用于快速丢弃操作",
      "model": "_Style.SWITCH_",
      "program": {
        "other.On": [
          {
            "class": "IKeyIuputTool",
            "Input": {
              "rate": 100,
              "key": "_Q_",
              "onKey": "_Z_",
              "fnKey":[],
              "repeat": -1
            }
          }
        ],
        "other.Off": [],
        "on.On": [
          {
            "class": "Toast",
            "message": "自动丢弃已激活",
            "duration": 2000,
            "type": "success"
          }
        ],
        "on.Off": [
          {
            "class": "Toast",
            "message": "自动丢弃已关闭",
            "duration": 2000,
            "type": "info"
          }
        ]
      }
    },
    {
      "name": "丢弃",
      "id": "com.example.plugins.manualdrop",
      "version": "1.0.0",
      "description": "点击后执行一次Q键组合，用于手动触发丢弃操作",
      "model": "_Style.Button_",
      "program": {
        "on.On": [],
        "on.Off": [],
        "on.Activate": [
          {
            "class": "IKeyIuputTool",
            "Input": {
              "rate": -1,
              "key": "_Q_",
              "onKey": "_Z_",
              "fnKey":[],
              "delay": 100
            }
          }
        ]
      }
    }
  ]
}
```
## 8. 开发与调试指南

### 8.1 开发步骤
1. 按照文档规范创建JSON配置文件
2. 填写根节点元数据
3. 在`_plugin`数组中添加插件定义
4. 为每个插件配置`program`操作序列
5. 验证JSON格式正确性（可使用在线JSON校验工具）

### 8.2 调试方法
- 配置文件放置路径：主程序安装目录下的`plugins`文件夹
- 错误排查：查看主程序的`plugin.log`日志文件，定位格式错误或逻辑错误
- 常见问题：
  - JSON格式错误：检查逗号、引号等语法符号
  - 按键不生效：确认按键标识是否正确（需用下划线包裹）
  - 插件不加载：检查`_type`字段是否为`_PLUGIN_PACK_`

### 8.3 最佳实践
- 为插件添加唯一`id`，便于版本管理和升级
- 关键操作添加`Toast`提示，提升用户体验
- 快捷键设置遵循系统规范，避免冲突
- 复杂操作拆分多个步骤，便于维护和调试
